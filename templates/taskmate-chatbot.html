<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TaskMate AI | Intelligent Task Management Chatbot</title>
  <meta name="description" content="AI-powered task management chatbot with natural language processing, voice recognition, and intelligent task organization." />
  
  <!-- Open Graph tags -->
  <meta property="og:title" content="TaskMate AI | Intelligent Task Management Chatbot" />
  <meta property="og:description" content="AI-powered task management chatbot with natural language processing, voice recognition, and intelligent task organization." />
  <meta property="og:type" content="website" />

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />

  <!-- Font Awesome for icons -->
  <script src="https://kit.fontawesome.com/a54d2cbf95.js" crossorigin="anonymous"></script>
  
  <!-- Three.js for 3D background -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  
  <!-- GSAP for animations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    :root {
      --clr-primary: hsl(248, 84%, 63%);
      --clr-secondary: hsl(195, 100%, 50%);
      --clr-accent: hsl(262, 83%, 58%);
      --clr-accent-2: hsl(188, 94%, 43%);
      --clr-bg: hsl(240, 21%, 6%);
      --clr-bg-light: hsl(240, 21%, 18%);
      --clr-dark: hsl(240, 21%, 18%);
      --clr-light: hsl(0, 0%, 100%);
      --clr-glass: hsla(0, 0%, 100%, 0.15);
      --clr-glass-border: hsla(0, 0%, 100%, 0.2);
      --radius-lg: 1.5rem;
      --radius-xl: 2rem;
      --transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-bounce: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    body {
      background: var(--clr-bg);
      color: var(--clr-light);
      line-height: 1.6;
      overflow-x: hidden;
      position: relative;
    }

    html {
      scroll-behavior: smooth;
    }

    /* Loading Screen */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--clr-bg);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    .loading-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loader {
      width: 50px;
      height: 50px;
      border: 3px solid hsla(0, 0%, 100%, 0.1);
      border-top: 3px solid var(--clr-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 3D Background Canvas */
    .bg-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.8;
    }

    /* Floating Shapes */
    .floating-shapes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .shape {
      position: absolute;
      background: linear-gradient(45deg, var(--clr-primary), var(--clr-secondary));
      border-radius: 50%;
      opacity: 0.1;
      animation: float 20s infinite linear;
    }

    .shape:nth-child(1) { width: 80px; height: 80px; top: 20%; left: 10%; animation-delay: 0s; }
    .shape:nth-child(2) { width: 120px; height: 120px; top: 60%; left: 80%; animation-delay: -5s; }
    .shape:nth-child(3) { width: 60px; height: 60px; top: 80%; left: 20%; animation-delay: -10s; }
    .shape:nth-child(4) { width: 100px; height: 100px; top: 30%; left: 70%; animation-delay: -15s; }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
      33% { transform: translateY(-30px) rotate(120deg) scale(1.1); }
      66% { transform: translateY(15px) rotate(240deg) scale(0.9); }
    }

    /* Main Chat Container */
    .chat-container {
      display: flex;
      height: 100vh;
      position: relative;
      background: linear-gradient(to bottom right, 
        hsla(240, 21%, 6%, 0.95), 
        hsla(262, 83%, 58%, 0.1), 
        hsla(248, 84%, 63%, 0.1));
    }

    /* Glassmorphism Background Overlay */
    .glass-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, 
        hsla(195, 100%, 50%, 0.1), 
        hsla(262, 83%, 58%, 0.1), 
        hsla(188, 94%, 43%, 0.1));
      backdrop-filter: blur(20px);
    }

    /* Task Sidebar */
    .task-sidebar {
      width: 320px;
      background: var(--clr-glass);
      backdrop-filter: blur(20px);
      border-right: 1px solid var(--clr-glass-border);
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 10;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--clr-glass-border);
    }

    .sidebar-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--clr-light);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .task-count {
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-secondary));
      color: var(--clr-light);
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border: 1px solid var(--clr-glass-border);
      background: transparent;
      color: var(--clr-light);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .filter-btn:hover {
      background: var(--clr-glass);
      transform: translateY(-2px);
    }

    .filter-btn.active {
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-secondary));
      border-color: transparent;
    }

    .tasks-list {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .task-item {
      background: var(--clr-glass);
      backdrop-filter: blur(10px);
      border: 1px solid var(--clr-glass-border);
      border-radius: var(--radius-lg);
      padding: 1rem;
      margin-bottom: 0.75rem;
      transition: var(--transition);
      cursor: pointer;
    }

    .task-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px hsla(0, 0%, 0%, 0.2);
      border-color: var(--clr-primary);
    }

    .task-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--clr-light);
    }

    .task-description {
      font-size: 0.875rem;
      color: hsla(0, 0%, 100%, 0.7);
      margin-bottom: 0.5rem;
    }

    .task-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: hsla(0, 0%, 100%, 0.6);
    }

    .task-status {
      padding: 0.25rem 0.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
    }

    .status-pending { background: hsla(0, 84%, 60%, 0.2); color: hsl(0, 84%, 60%); }
    .status-in_progress { background: hsla(38, 92%, 50%, 0.2); color: hsl(38, 92%, 50%); }
    .status-completed { background: hsla(142, 76%, 36%, 0.2); color: hsl(142, 76%, 36%); }

    /* Chat Interface */
    .chat-interface {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 10;
    }

    .chat-header {
      background: var(--clr-glass);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--clr-glass-border);
      padding: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .bot-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .bot-avatar {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.25rem;
      color: var(--clr-light);
      box-shadow: 0 10px 25px hsla(248, 84%, 63%, 0.4);
    }

    .bot-details h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .bot-details p {
      color: hsla(0, 0%, 100%, 0.7);
      font-size: 0.875rem;
    }

    .chat-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: hsla(0, 0%, 100%, 0.7);
      font-size: 0.875rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: hsl(142, 76%, 36%);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .clear-btn {
      background: transparent;
      border: 1px solid var(--clr-glass-border);
      color: var(--clr-light);
      padding: 0.5rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .clear-btn:hover {
      background: var(--clr-glass);
      transform: translateY(-2px);
    }

    /* Messages Container */
    .messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .message {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    .user-avatar {
      background: var(--clr-glass);
      border: 1px solid var(--clr-glass-border);
      color: var(--clr-light);
    }

    .bot-message-avatar {
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-secondary));
      color: var(--clr-light);
    }

    .message-content {
      max-width: 70%;
      background: var(--clr-glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--clr-glass-border);
      border-radius: var(--radius-xl);
      padding: 1.25rem;
      position: relative;
    }

    .message.user .message-content {
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-secondary));
      border: none;
    }

    .message-text {
      color: var(--clr-light);
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .message-time {
      font-size: 0.75rem;
      color: hsla(0, 0%, 100%, 0.5);
      margin-top: 0.5rem;
    }

    .typing-indicator {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }

    .typing-dots {
      background: var(--clr-glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--clr-glass-border);
      border-radius: var(--radius-xl);
      padding: 1rem;
      display: flex;
      gap: 0.5rem;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: hsla(0, 0%, 100%, 0.6);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: 0ms; }
    .typing-dot:nth-child(2) { animation-delay: 160ms; }
    .typing-dot:nth-child(3) { animation-delay: 320ms; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }

    /* Input Area */
    .input-area {
      background: var(--clr-glass);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--clr-glass-border);
      padding: 1.5rem;
    }

    .input-container {
      position: relative;
      display: flex;
      align-items: flex-end;
      gap: 1rem;
    }

    .message-input {
      flex: 1;
      background: hsla(0, 0%, 100%, 0.1);
      border: 1px solid var(--clr-glass-border);
      border-radius: var(--radius-lg);
      padding: 1rem 3.5rem 1rem 1.25rem;
      color: var(--clr-light);
      font-size: 1rem;
      resize: none;
      min-height: 50px;
      max-height: 120px;
      transition: var(--transition);
    }

    .message-input:focus {
      outline: none;
      border-color: var(--clr-primary);
      background: hsla(0, 0%, 100%, 0.15);
      box-shadow: 0 0 0 3px hsla(248, 84%, 63%, 0.2);
    }

    .message-input::placeholder {
      color: hsla(0, 0%, 100%, 0.6);
    }

    .input-buttons {
      position: absolute;
      right: 0.5rem;
      bottom: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }

    .input-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .voice-btn {
      background: transparent;
      color: var(--clr-light);
      border: 1px solid var(--clr-glass-border);
    }

    .voice-btn:hover {
      background: var(--clr-glass);
      transform: scale(1.05);
    }

    .voice-btn.listening {
      background: hsl(0, 84%, 60%);
      color: var(--clr-light);
      animation: pulse 1s infinite;
    }

    .send-btn {
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-secondary));
      color: var(--clr-light);
      border: none;
    }

    .send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px hsla(248, 84%, 63%, 0.4);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .input-hints {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.75rem;
      font-size: 0.75rem;
      color: hsla(0, 0%, 100%, 0.6);
    }

    /* Welcome Message */
    .welcome-message {
      text-align: center;
      padding: 2rem;
      color: hsla(0, 0%, 100%, 0.8);
    }

    .welcome-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-suggestions {
      list-style: none;
      margin-top: 1.5rem;
    }

    .welcome-suggestions li {
      margin: 0.5rem 0;
      padding: 0.75rem 1rem;
      background: var(--clr-glass);
      border: 1px solid var(--clr-glass-border);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition);
    }

    .welcome-suggestions li:hover {
      background: hsla(0, 0%, 100%, 0.2);
      transform: translateY(-2px);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .chat-container {
        flex-direction: column;
      }

      .task-sidebar {
        width: 100%;
        max-height: 40vh;
        border-right: none;
        border-bottom: 1px solid var(--clr-glass-border);
      }

      .message-content {
        max-width: 85%;
      }

      .filter-buttons {
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }
    }

    /* Notification styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      z-index: 10000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .notification.success {
      background: #22c55e;
    }

    .notification.error {
      background: #ef4444;
    }

    .notification.info {
      background: #3b82f6;
    }

    .notification.show {
      transform: translateX(0);
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loader"></div>
  </div>

  <!-- Three.js Background -->
  <canvas class="bg-canvas" id="bgCanvas"></canvas>
  <div class="floating-shapes">
    <div class="shape"></div>
    <div class="shape"></div>
    <div class="shape"></div>
    <div class="shape"></div>
  </div>

  <!-- Main Chat Container -->
  <div class="chat-container">
    <div class="glass-bg"></div>
    
    <!-- Task Sidebar -->
    <div class="task-sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">
          <i class="fas fa-tasks"></i>
          My Tasks
          <span class="task-count" id="taskCount">0</span>
        </div>
        <div class="filter-buttons">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="pending">Pending</button>
          <button class="filter-btn" data-filter="in_progress">In Progress</button>
          <button class="filter-btn" data-filter="completed">Completed</button>
        </div>
      </div>
      <div class="tasks-list" id="tasksList">
        <!-- Tasks will be populated here -->
      </div>
    </div>

    <!-- Chat Interface -->
    <div class="chat-interface">
      <!-- Chat Header -->
      <div class="chat-header">
        <div class="bot-info">
          <div class="bot-avatar">TM</div>
          <div class="bot-details">
            <h1>TaskMate AI</h1>
            <p>Your Intelligent Task Assistant</p>
          </div>
        </div>
        <div class="chat-actions">
          <div class="status-indicator">
            <div class="status-dot"></div>
            <span>Online</span>
          </div>
          <button class="clear-btn" id="clearChat" title="Clear chat">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>

      <!-- Messages Container -->
      <div class="messages-container" id="messagesContainer">
        <div class="welcome-message">
          <h2 class="welcome-title">Welcome to TaskMate AI!</h2>
          <p>I'm your intelligent task management assistant. I can help you create, organize, and manage your tasks using natural language.</p>
          <ul class="welcome-suggestions">
            <li onclick="sendSuggestion('Create a task to review the project proposal')">Create a task to review the project proposal</li>
            <li onclick="sendSuggestion('Show me all pending tasks')">Show me all pending tasks</li>
            <li onclick="sendSuggestion('Mark the presentation task as completed')">Mark the presentation task as completed</li>
            <li onclick="sendSuggestion('What tasks do I have for today?')">What tasks do I have for today?</li>
          </ul>
        </div>
      </div>

      <!-- Input Area -->
      <div class="input-area">
        <div class="input-container">
          <textarea
            id="messageInput"
            class="message-input"
            placeholder="Type your message... (e.g., 'Create a task to...', 'Show me completed tasks')"
            rows="1"
          ></textarea>
          <div class="input-buttons">
            <button class="input-btn voice-btn" id="voiceBtn" title="Voice input">
              <i class="fas fa-microphone"></i>
            </button>
            <button class="input-btn send-btn" id="sendBtn" title="Send message">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
        <div class="input-hints">
          <span>ðŸ’¡ Try: "Create a task", "Show my tasks", "Mark as complete"</span>
          <span>Press Enter to send â€¢ Click mic to speak</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let particleSystem = null;
    let animationId = null;
    let tasks = JSON.parse(localStorage.getItem('taskmate_tasks')) || [];
    let messages = JSON.parse(localStorage.getItem('taskmate_messages')) || [];
    let currentFilter = 'all';
    let isListening = false;
    let isTyping = false;

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    function initializeApp() {
      // Hide loading screen
      setTimeout(() => {
        document.getElementById('loadingOverlay').classList.add('hidden');
      }, 1000);

      // Initialize Three.js background
      initThreeJS();

      // Setup event listeners
      setupEventListeners();

      // Render initial data
      renderTasks();
      renderMessages();

      // Auto-resize textarea
      setupTextareaResize();
    }

    // Three.js Background
    function initThreeJS() {
      const canvas = document.getElementById('bgCanvas');
      if (!canvas || !window.THREE) return;

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);

      // Create particles
      const particleCount = 100;
      const positions = new Float32Array(particleCount * 3);
      const velocities = [];

      for (let i = 0; i < particleCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 10;
        positions[i * 3 + 1] = (Math.random() - 0.5) * 10;
        positions[i * 3 + 2] = (Math.random() - 0.5) * 10;
        
        velocities.push({
          x: (Math.random() - 0.5) * 0.01,
          y: (Math.random() - 0.5) * 0.01,
          z: (Math.random() - 0.5) * 0.01
        });
      }

      const geometry = new THREE.BufferGeometry();
      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

      const material = new THREE.PointsMaterial({
        color: 0x5d5fef,
        size: 0.05,
        transparent: true,
        opacity: 0.6
      });

      const particles = new THREE.Points(geometry, material);
      scene.add(particles);
      camera.position.z = 5;

      particleSystem = { scene, camera, renderer, particles, velocities };

      // Animation loop
      function animate() {
        if (particleSystem) {
          animateParticles();
        }
        animationId = requestAnimationFrame(animate);
      }
      animate();

      // Handle resize
      window.addEventListener('resize', () => {
        if (particleSystem) {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        }
      });
    }

    function animateParticles() {
      if (!particleSystem) return;

      const { particles, velocities, renderer, scene, camera } = particleSystem;
      const particleCount = velocities.length;

      const positions = particles.geometry.attributes.position.array;
      for (let i = 0; i < particleCount; i++) {
        positions[i * 3] += velocities[i].x;
        positions[i * 3 + 1] += velocities[i].y;
        positions[i * 3 + 2] += velocities[i].z;

        if (positions[i * 3] > 5) positions[i * 3] = -5;
        if (positions[i * 3] < -5) positions[i * 3] = 5;
        if (positions[i * 3 + 1] > 5) positions[i * 3 + 1] = -5;
        if (positions[i * 3 + 1] < -5) positions[i * 3 + 1] = 5;
      }
      particles.geometry.attributes.position.needsUpdate = true;

      particles.rotation.x += 0.001;
      particles.rotation.y += 0.002;

      renderer.render(scene, camera);
    }

    // Event Listeners
    function setupEventListeners() {
      const messageInput = document.getElementById('messageInput');
      const sendBtn = document.getElementById('sendBtn');
      const voiceBtn = document.getElementById('voiceBtn');
      const clearBtn = document.getElementById('clearChat');

      // Send message
      sendBtn.addEventListener('click', sendMessage);
      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      // Voice recognition
      voiceBtn.addEventListener('click', toggleVoiceRecognition);

      // Clear chat
      clearBtn.addEventListener('click', clearChat);

      // Filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const filter = e.target.dataset.filter;
          setFilter(filter);
        });
      });
    }

    function setupTextareaResize() {
      const textarea = document.getElementById('messageInput');
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
      });
    }

    // Messaging Functions
    function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      
      if (!message || isTyping) return;

      // Add user message
      addMessage('user', message);
      input.value = '';
      input.style.height = 'auto';

      // Hide welcome message
      hideWelcomeMessage();

      // Process with AI (simulated)
      processAIMessage(message);
    }

    function sendSuggestion(text) {
      document.getElementById('messageInput').value = text;
      sendMessage();
    }

    function addMessage(role, content, data = null) {
      const timestamp = new Date().toISOString();
      const message = { id: Date.now(), role, content, timestamp, data };
      
      messages.push(message);
      saveMessages();
      renderMessage(message);
      scrollToBottom();
    }

    function renderMessage(message) {
      const container = document.getElementById('messagesContainer');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${message.role}`;
      
      const avatar = document.createElement('div');
      avatar.className = `message-avatar ${message.role === 'user' ? 'user-avatar' : 'bot-message-avatar'}`;
      avatar.textContent = message.role === 'user' ? 'U' : 'TM';
      
      const content = document.createElement('div');
      content.className = 'message-content';
      
      const text = document.createElement('div');
      text.className = 'message-text';
      text.textContent = message.content;
      
      const time = document.createElement('div');
      time.className = 'message-time';
      time.textContent = formatTime(message.timestamp);
      
      content.appendChild(text);
      content.appendChild(time);
      
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(content);
      
      container.appendChild(messageDiv);
    }

    function renderMessages() {
      const container = document.getElementById('messagesContainer');
      // Clear existing messages but keep welcome message
      const welcomeMsg = container.querySelector('.welcome-message');
      container.innerHTML = '';
      if (messages.length === 0 && welcomeMsg) {
        container.appendChild(welcomeMsg);
      }
      
      messages.forEach(message => renderMessage(message));
      scrollToBottom();
    }

    function hideWelcomeMessage() {
      const welcomeMsg = document.querySelector('.welcome-message');
      if (welcomeMsg) {
        welcomeMsg.style.display = 'none';
      }
    }

    function showTypingIndicator() {
      const container = document.getElementById('messagesContainer');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'typing-indicator';
      typingDiv.id = 'typingIndicator';
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar bot-message-avatar';
      avatar.textContent = 'TM';
      
      const dots = document.createElement('div');
      dots.className = 'typing-dots';
      for (let i = 0; i < 3; i++) {
        const dot = document.createElement('div');
        dot.className = 'typing-dot';
        dots.appendChild(dot);
      }
      
      typingDiv.appendChild(avatar);
      typingDiv.appendChild(dots);
      container.appendChild(typingDiv);
      scrollToBottom();
    }

    function hideTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) {
        indicator.remove();
      }
    }

    // AI Processing (Simulated)
    function processAIMessage(userMessage) {
      isTyping = true;
      showTypingIndicator();
      
      // Simulate AI processing delay
      setTimeout(() => {
        const response = generateAIResponse(userMessage);
        hideTypingIndicator();
        addMessage('assistant', response.message, response.data);
        
        // Execute any commands
        if (response.command) {
          executeCommand(response.command);
        }
        
        isTyping = false;
      }, 1000 + Math.random() * 2000);
    }

    function generateAIResponse(message) {
      const lowerMessage = message.toLowerCase();
      
      // Task creation
      if (lowerMessage.includes('create') || lowerMessage.includes('add')) {
        const taskTitle = extractTaskTitle(message);
        if (taskTitle) {
          const task = createTask(taskTitle);
          return {
            message: `Great! I've created a new task: "${taskTitle}". It's been added to your pending tasks.`,
            command: { action: 'create', task },
            data: { tasks: [task] }
          };
        }
      }
      
      // Show tasks
      if (lowerMessage.includes('show') || lowerMessage.includes('list') || lowerMessage.includes('tasks')) {
        const filteredTasks = getFilteredTasks(lowerMessage);
        const count = filteredTasks.length;
        const status = extractStatus(lowerMessage) || 'all';
        
        return {
          message: `You have ${count} ${status === 'all' ? '' : status + ' '}task${count !== 1 ? 's' : ''}${count > 0 ? ':' : '.'}`,
          data: { tasks: filteredTasks }
        };
      }
      
      // Mark as complete
      if (lowerMessage.includes('complete') || lowerMessage.includes('done') || lowerMessage.includes('finish')) {
        const taskId = extractTaskId(message);
        if (taskId) {
          const task = updateTaskStatus(taskId, 'completed');
          if (task) {
            return {
              message: `Excellent! I've marked "${task.title}" as completed. Great job!`,
              command: { action: 'update', task }
            };
          }
        }
        return {
          message: "I'd be happy to mark a task as complete! Could you specify which task you'd like to complete?"
        };
      }
      
      // Delete task
      if (lowerMessage.includes('delete') || lowerMessage.includes('remove')) {
        return {
          message: "I can help you delete tasks. Which specific task would you like to remove?"
        };
      }
      
      // Default responses
      const responses = [
        "I'm here to help you manage your tasks! You can ask me to create tasks, show your task list, mark tasks as complete, or organize your workflow.",
        "I can help you with task management. Try saying things like 'Create a task to...' or 'Show me my pending tasks'.",
        "I'm your intelligent task assistant! I can create, organize, and track your tasks. What would you like to work on today?"
      ];
      
      return {
        message: responses[Math.floor(Math.random() * responses.length)]
      };
    }

    function extractTaskTitle(message) {
      const patterns = [
        /create(?:\s+a)?\s+task\s+to\s+(.+)/i,
        /add(?:\s+a)?\s+task\s+to\s+(.+)/i,
        /create\s+(.+)/i,
        /add\s+(.+)/i
      ];
      
      for (const pattern of patterns) {
        const match = message.match(pattern);
        if (match) {
          return match[1].trim();
        }
      }
      
      return null;
    }

    function extractStatus(message) {
      if (message.includes('pending')) return 'pending';
      if (message.includes('progress') || message.includes('working')) return 'in_progress';
      if (message.includes('complete') || message.includes('done')) return 'completed';
      return null;
    }

    function extractTaskId(message) {
      // In a real implementation, this would be more sophisticated
      // For demo purposes, we'll just try to complete the most recent pending task
      const pendingTasks = tasks.filter(t => t.status === 'pending');
      return pendingTasks.length > 0 ? pendingTasks[0].id : null;
    }

    function executeCommand(command) {
      if (command.action === 'create') {
        renderTasks();
        showNotification('Task created successfully!', 'success');
      } else if (command.action === 'update') {
        renderTasks();
        showNotification('Task updated successfully!', 'success');
      }
    }

    // Task Management
    function createTask(title, description = '', status = 'pending', priority = 'medium') {
      const task = {
        id: Date.now(),
        title: title.trim(),
        description: description.trim(),
        status,
        priority,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      tasks.unshift(task);
      saveTasks();
      return task;
    }

    function updateTaskStatus(taskId, status) {
      const task = tasks.find(t => t.id === taskId);
      if (task) {
        task.status = status;
        task.updatedAt = new Date().toISOString();
        saveTasks();
        return task;
      }
      return null;
    }

    function getFilteredTasks(query = '') {
      let filteredTasks = tasks;
      
      if (query.includes('pending')) {
        filteredTasks = tasks.filter(t => t.status === 'pending');
      } else if (query.includes('progress')) {
        filteredTasks = tasks.filter(t => t.status === 'in_progress');
      } else if (query.includes('complete') || query.includes('done')) {
        filteredTasks = tasks.filter(t => t.status === 'completed');
      }
      
      return filteredTasks;
    }

    function renderTasks() {
      const container = document.getElementById('tasksList');
      const filteredTasks = currentFilter === 'all' 
        ? tasks 
        : tasks.filter(t => t.status === currentFilter);
      
      container.innerHTML = '';
      
      if (filteredTasks.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: hsla(0, 0%, 100%, 0.6);">
            <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
            <div>No ${currentFilter === 'all' ? '' : currentFilter + ' '}tasks yet</div>
          </div>
        `;
        updateTaskCount(0);
        return;
      }
      
      filteredTasks.forEach(task => {
        const taskElement = createTaskElement(task);
        container.appendChild(taskElement);
      });
      
      updateTaskCount(filteredTasks.length);
    }

    function createTaskElement(task) {
      const div = document.createElement('div');
      div.className = 'task-item';
      div.innerHTML = `
        <div class="task-title">${escapeHtml(task.title)}</div>
        ${task.description ? `<div class="task-description">${escapeHtml(task.description)}</div>` : ''}
        <div class="task-meta">
          <span>${formatDate(task.createdAt)}</span>
          <span class="task-status status-${task.status}">${formatStatus(task.status)}</span>
        </div>
      `;
      return div;
    }

    function setFilter(filter) {
      currentFilter = filter;
      
      // Update button states
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
      
      renderTasks();
    }

    function updateTaskCount(count) {
      document.getElementById('taskCount').textContent = count;
    }

    // Voice Recognition
    function toggleVoiceRecognition() {
      if (isListening) {
        stopListening();
      } else {
        startListening();
      }
    }

    function startListening() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        showNotification('Speech recognition is not supported in this browser', 'error');
        return;
      }

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      isListening = true;
      updateVoiceButton();

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('messageInput').value = transcript;
        stopListening();
      };

      recognition.onerror = () => {
        stopListening();
        showNotification('Speech recognition error. Please try again.', 'error');
      };

      recognition.onend = () => {
        stopListening();
      };

      recognition.start();
    }

    function stopListening() {
      isListening = false;
      updateVoiceButton();
    }

    function updateVoiceButton() {
      const btn = document.getElementById('voiceBtn');
      const icon = btn.querySelector('i');
      
      if (isListening) {
        btn.classList.add('listening');
        icon.className = 'fas fa-microphone-slash';
      } else {
        btn.classList.remove('listening');
        icon.className = 'fas fa-microphone';
      }
    }

    // Utility Functions
    function clearChat() {
      if (confirm('Are you sure you want to clear all messages?')) {
        messages = [];
        saveMessages();
        renderMessages();
        showNotification('Chat cleared successfully!', 'info');
      }
    }

    function scrollToBottom() {
      const container = document.getElementById('messagesContainer');
      container.scrollTop = container.scrollHeight;
    }

    function formatTime(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleTimeString('en-US', { 
        hour: 'numeric', 
        minute: '2-digit',
        hour12: true 
      });
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diffTime = now.getTime() - date.getTime();
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

      if (diffDays === 0) return 'Today';
      if (diffDays === 1) return 'Yesterday';
      if (diffDays < 7) return `${diffDays} days ago`;
      
      return date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric' 
      });
    }

    function formatStatus(status) {
      switch (status) {
        case 'pending': return 'Pending';
        case 'in_progress': return 'In Progress';
        case 'completed': return 'Completed';
        default: return status;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.classList.add('show');
      }, 10);

      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Local Storage Functions
    function saveTasks() {
      localStorage.setItem('taskmate_tasks', JSON.stringify(tasks));
    }

    function saveMessages() {
      localStorage.setItem('taskmate_messages', JSON.stringify(messages));
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
    });
  </script>
</body>
</html>